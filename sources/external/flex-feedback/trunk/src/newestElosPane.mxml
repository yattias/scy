<?xml version="1.0" encoding="utf-8"?>
<s:NavigatorContent xmlns:fx="http://ns.adobe.com/mxml/2009" 
					xmlns:s="library://ns.adobe.com/flex/spark" 
					xmlns:mx="library://ns.adobe.com/flex/mx" creationComplete="navigatorcontent1_creationCompleteHandler(event)">
	<fx:Script>
		<![CDATA[
			import mx.collections.ArrayCollection;
			import mx.controls.Alert;
			import mx.core.FlexGlobals;
			import mx.events.FlexEvent;
			import mx.managers.CursorManager;
			import mx.rpc.events.FaultEvent;
			import mx.rpc.events.ResultEvent;
			
			import utility.XMLUtilJer;
			
			private var objectsToTile:ArrayCollection;
			private var so:SharedObject;
			
			protected function navigatorcontent1_creationCompleteHandler(event:FlexEvent):void {
				so = SharedObject.getLocal(index.SHAREDOBJECT_LOCAL_NAME);
				
				feedbackService.url = new String(so.data.newestelosfeedbackservice)+"?missionURI="+decodeURI(new String(FlexGlobals.topLevelApplication.parameters.missionURI)).replace("#", "%23");
				if(FlexGlobals.topLevelApplication.url.indexOf("file:///") > -1 || FlexGlobals.topLevelApplication.url.indexOf("www-data-public") > -1) {
					feedbackService.url = new String(so.data.newestelosfeedbackservice).substring(1)+"?missionURI="+decodeURI(FlexGlobals.topLevelApplication.parameters.missionURI).replace("#", "%23");
				}
				
				feedbackService.send();
			}
			
			private function buildTile():void {
				dataTile.removeAllElements();
				for each (var tcell:tileCell in objectsToTile) {
					dataTile.addElement(tcell);
				}
			}
			
			protected function feedbackService_resultHandler(event:ResultEvent):void {
				var xml:XML= event.result as XML;
				var tc:tileCell;
				objectsToTile = new ArrayCollection();
				for each (var object:XML in xml.*) {
					if (object.name() == "elo") {
						var eloObj:Object = XMLUtilJer.getEloObjectFromXML(object);
						tc = XMLUtilJer.getTileCellEloFromObject(eloObj);
						
						if(tc.rawdatathumb == "") {
							tc.rawdatathumb = index.NOTHUMB;
						}
						
						tc.shown = "0";
						tc.eval = "0";
						tc.score = "0";
						objectsToTile.addItem(tc);
					}
				}
				
				buildTile();
			}
			
			
			protected function feedbackService_faultHandler(event:FaultEvent):void {
				Alert.show(resourceManager.getString('resources', 'URL_PROPERTY_FILE_ERROR'), "HTTPService Error");
			}
			

		]]>
	</fx:Script>
	
	<fx:Declarations>
		<s:HTTPService id="feedbackService" 
					   showBusyCursor="true" 
					   result="feedbackService_resultHandler(event)" 
					   fault="feedbackService_faultHandler(event)"
					   resultFormat="e4x"/>
	</fx:Declarations>
	
	<s:Scroller id="scroll" width="100%" height="100%" chromeColor="{index.THEME_COL}">
		<s:VGroup id="grp" width="100%" height="100%" horizontalAlign="center" gap="0">
			<mx:Spacer height="5" />
			<s:TileGroup id="dataTile" width="{grp.width - 10}" horizontalCenter="0" verticalCenter="0"/>
			<mx:Spacer height="5" />
		</s:VGroup>
	</s:Scroller>
</s:NavigatorContent>
